<% layout('layout/boilerplate') %>

    <div class="orders-wrapper py-5">
        <div class="d-flex justify-content-between align-items-center mb-5">
            <div>
                <h2 class="fw-bold mb-1">My Orders</h2>
                <p class="text-muted mb-0">Track and manage your recent purchases</p>
            </div>
            <div class="d-none d-md-block">
                <a href="/products" class="btn btn-outline-primary rounded-pill px-4">Continue Shopping</a>
            </div>
        </div>

        <!-- No Orders State (Optional/Future) -->
        <!-- 
    <div class="text-center py-5">
        <div class="bg-light d-inline-flex p-4 rounded-circle mb-4">
            <i class="fa-solid fa-box-open fa-3x text-muted opacity-50"></i>
        </div>
        <h4 class="fw-bold">No orders found</h4>
        <p class="text-muted">You haven't placed any orders yet.</p>
        <a href="/products" class="btn btn-primary rounded-pill px-5 py-3 mt-3">Start Shopping</a>
    </div> 
    -->

        <div class="orders-list">
            <% if (orders && orders.length> 0) { %>
                <% for (let order of orders) { %>
                    <!-- Order Card -->
                    <div
                        class="order-card card border-0 shadow-sm rounded-4 overflow-hidden mb-4 bg-white transition-all">
                        <div
                            class="card-header bg-white p-4 border-bottom border-light d-flex flex-wrap justify-content-between align-items-center gap-3">
                            <div class="d-flex gap-4">
                                <div>
                                    <p class="small text-muted text-uppercase fw-bold mb-1">Order Placed</p>
                                    <p class="mb-0 fw-semibold">
                                        <%= order.createdAt.toLocaleDateString('en-US', { month: 'long' , day: 'numeric'
                                            , year: 'numeric' }) %>
                                    </p>
                                </div>
                                <div>
                                    <p class="small text-muted text-uppercase fw-bold mb-1">Total Amount</p>
                                    <p class="mb-0 fw-bold text-primary">$<%= order.totalAmount.toFixed(2) %>
                                    </p>
                                </div>
                            </div>
                            <div class="text-md-end">
                                <p class="small text-muted text-uppercase fw-bold mb-1">Order #<%=
                                        order._id.toString().slice(-8).toUpperCase() %>
                                </p>
                                <span class="badge rounded-pill 
                                    <%= order.status === 'Delivered' ? 'bg-success-subtle text-success' : 
                                       order.status === 'Cancelled' ? 'bg-danger-subtle text-danger' : 
                                       'bg-warning-subtle text-warning' %> px-3 py-2">
                                    <i
                                        class="fa-solid <%= order.status === 'Delivered' ? 'fa-circle-check' : 'fa-clock' %> me-1 small"></i>
                                    <%= order.status %>
                                </span>
                            </div>
                        </div>
                        <div class="card-body p-4">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex gap-3 overflow-auto pb-2">
                                        <% for (let item of order.items) { %>
                                            <div class="order-item-thumb rounded-3 border p-1"
                                                style="width: 80px; height: 80px; flex-shrink: 0;"
                                                title="<%= item.product ? item.product.title : 'Product' %>">
                                                <img src="<%= item.product ? item.product.image : '/images/placeholder.jpg' %>"
                                                    class="img-fluid rounded-2 w-100 h-100 object-fit-cover"
                                                    alt="product">
                                            </div>
                                            <% } %>
                                    </div>
                                    <p class="mt-3 mb-0 small text-muted">
                                        <% if (order.status==='Delivered' ) { %>
                                            Delivered on <%= order.updatedAt ? order.updatedAt.toLocaleDateString() :
                                                order.createdAt.toLocaleDateString() %>
                                                <% } else { %>
                                                    Status: <%= order.status %>
                                                        <% } %>
                                    </p>
                                </div>
                                <div class="col-md-4 text-md-end mt-4 mt-md-0">
                                    <div class="d-grid gap-2">
                                        <a href="/orders/<%= order._id %>"
                                            class="btn btn-primary rounded-pill fw-bold py-2">View Order
                                            Details</a>
                                        <a href="/products" class="btn btn-outline-dark rounded-pill fw-bold py-2">Buy
                                            it Again</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <% } %>
                        <% } else { %>
                            <div class="text-center py-5">
                                <div class="bg-light d-inline-flex p-4 rounded-circle mb-4">
                                    <i class="fa-solid fa-box-open fa-3x text-muted opacity-50"></i>
                                </div>
                                <h4 class="fw-bold">No orders found</h4>
                                <p class="text-muted">You haven't placed any orders yet.</p>
                                <a href="/products" class="btn btn-primary rounded-pill px-5 py-3 mt-3">Start
                                    Shopping</a>
                            </div>
                            <% } %>
        </div>
    </div>